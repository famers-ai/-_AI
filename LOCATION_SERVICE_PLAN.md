# 🌍 위치 기반 서비스 구현 계획

## 📋 개요

사용자 위치 정보를 활용하여 맞춤형 농업 서비스를 제공하면서, 법적/보안 리스크를 최소화합니다.

---

## 🎯 목표

### 1. 사용자 편의성
- ✅ 자동 날씨 정보 (사용자 위치 기반)
- ✅ 지역별 병해충 예보
- ✅ 지역 시장 가격 정보
- ✅ 지역 맞춤형 작물 추천

### 2. 법적 준수
- ✅ GDPR (유럽 개인정보보호법) 준수
- ✅ CCPA (캘리포니아 소비자 프라이버시법) 준수
- ✅ 한국 개인정보보호법 준수
- ✅ 명시적 사용자 동의

### 3. 보안
- ✅ 최소 데이터 수집 (도시 수준, GPS 좌표 아님)
- ✅ 암호화 저장
- ✅ 언제든 삭제 가능
- ✅ 제3자 공유 없음

---

## 🔧 기술 구현

### Phase 1: 위치 정보 수집 (안전한 방식)

#### 방법 1: IP 기반 위치 (추천) ⭐️
**장점**:
- 사용자 권한 불필요
- 법적 리스크 최소
- 도시 수준 정확도 (충분함)

**단점**:
- VPN 사용 시 부정확

**구현**:
```javascript
// 무료 IP Geolocation API
fetch('https://ipapi.co/json/')
  .then(res => res.json())
  .then(data => {
    // data.city, data.region, data.country_name
  })
```

#### 방법 2: 브라우저 Geolocation API (선택적)
**장점**:
- 더 정확한 위치

**단점**:
- 사용자 권한 필요
- 법적 리스크 증가

**구현**:
```javascript
// 명시적 동의 후에만
if (userConsented) {
  navigator.geolocation.getCurrentPosition(position => {
    // 정확한 좌표 대신 도시명만 저장
  })
}
```

#### 방법 3: 수동 입력 (항상 제공)
**장점**:
- 100% 사용자 제어
- 법적 리스크 없음

**단점**:
- 사용자 액션 필요

---

### Phase 2: 데이터 저장 전략

#### 저장하는 것 ✅
- 도시명 (예: "San Francisco")
- 지역/주 (예: "California")
- 국가 (예: "United States")
- 우편번호 (선택적)

#### 저장하지 않는 것 ❌
- 정확한 GPS 좌표
- IP 주소
- 상세 주소

#### 데이터베이스 스키마
```sql
-- users 테이블에 추가
ALTER TABLE users ADD COLUMN location_city TEXT;
ALTER TABLE users ADD COLUMN location_region TEXT;
ALTER TABLE users ADD COLUMN location_country TEXT;
ALTER TABLE users ADD COLUMN location_consent BOOLEAN DEFAULT 0;
ALTER TABLE users ADD COLUMN location_updated_at TIMESTAMP;
```

---

### Phase 3: 개인정보 처리방침 업데이트

#### 필수 포함 사항
1. **수집 목적**: 맞춤형 날씨/병해충 정보 제공
2. **수집 방법**: IP 기반 또는 사용자 입력
3. **보관 기간**: 계정 삭제 시까지
4. **제3자 제공**: 없음
5. **사용자 권리**: 언제든 삭제/수정 가능

---

### Phase 4: UI/UX 구현

#### 1. 초기 설정 (첫 로그인 시)
```
┌─────────────────────────────────────────┐
│  🌍 위치 설정                            │
│                                         │
│  더 나은 서비스를 위해 위치를 설정해주세요  │
│                                         │
│  [자동 감지] [수동 입력] [나중에]         │
│                                         │
│  ℹ️ 도시 수준의 위치만 저장됩니다         │
│  ℹ️ 언제든 변경/삭제 가능합니다          │
└─────────────────────────────────────────┘
```

#### 2. 대시보드 헤더
```
┌─────────────────────────────────────────┐
│  📍 San Francisco, CA                    │
│  [변경]                                  │
└─────────────────────────────────────────┘
```

#### 3. 설정 페이지
```
위치 정보
├─ 현재 위치: San Francisco, CA
├─ [위치 변경]
├─ [위치 정보 삭제]
└─ 마지막 업데이트: 2026-01-28
```

---

## 📜 법적 준수 체크리스트

### GDPR (유럽)
- [x] 명시적 동의 (Opt-in)
- [x] 목적 명시
- [x] 데이터 최소화
- [x] 삭제 권리 (Right to be forgotten)
- [x] 이동 권리 (Data portability)
- [x] 투명성

### CCPA (캘리포니아)
- [x] 수집 고지
- [x] 삭제 권리
- [x] 판매 금지 (우리는 판매 안 함)
- [x] 차별 금지

### 한국 개인정보보호법
- [x] 동의 획득
- [x] 목적 외 사용 금지
- [x] 안전성 확보 조치
- [x] 파기 의무

---

## 🔒 보안 조치

### 1. 데이터 암호화
```python
# 저장 시 암호화 (선택적 - 도시명은 민감하지 않음)
# 하지만 best practice로 구현
```

### 2. 접근 제어
- 사용자는 본인 위치만 조회/수정 가능
- 관리자도 위치 정보 직접 조회 불가 (로그만)

### 3. 감사 로그
```sql
CREATE TABLE location_audit_log (
    id INTEGER PRIMARY KEY,
    user_id TEXT,
    action TEXT, -- 'set', 'update', 'delete'
    timestamp TIMESTAMP,
    ip_address TEXT (hashed)
);
```

---

## 🚀 구현 순서

### Week 1: 기반 구축
1. ✅ 데이터베이스 스키마 업데이트
2. ✅ 개인정보 처리방침 업데이트
3. ✅ 이용약관 업데이트

### Week 2: 백엔드 API
1. ✅ 위치 정보 저장 API
2. ✅ 위치 정보 조회 API
3. ✅ 위치 정보 삭제 API
4. ✅ IP 기반 위치 감지 API

### Week 3: 프론트엔드 UI
1. ✅ 위치 설정 모달
2. ✅ 대시보드 위치 표시
3. ✅ 설정 페이지 위치 관리

### Week 4: 통합 및 테스트
1. ✅ 위치 기반 날씨 자동 로딩
2. ✅ 위치 기반 병해충 예보
3. ✅ 법적 준수 검토
4. ✅ 보안 테스트

---

## 📊 성공 지표

### 사용자 경험
- 위치 설정 완료율 > 70%
- 위치 변경 빈도 < 5% (정확하다는 의미)
- 사용자 만족도 > 4.5/5

### 법적/보안
- 개인정보 침해 신고: 0건
- 보안 사고: 0건
- 규제 준수: 100%

---

## 🎯 다음 단계

1. **즉시 시작**: 데이터베이스 스키마 업데이트
2. **우선순위**: 개인정보 처리방침 작성
3. **병렬 작업**: 백엔드 API + 프론트엔드 UI

---

**작성일**: 2026-01-28  
**상태**: 계획 수립 완료, 구현 준비 중
